# 最大流应用

## 二分图匹配

### 转为最大流

二分图最大匹配可以转换成网络流模型。

给定一个二分图 $G = (X \cup Y, E)$ ，其中 $X$ 和 $Y$ 是两组顶点，$E$ 是连接 $X$ 和 $Y$ 的边集合。我们可以构造一个流网络 $G'$ ：

从源点 $s$ 向 $X$ 中所有点添加容量为 1 的边，从 $Y$ 中的每个顶点向汇点 $t$ 添加容量为 1 的边

原来的每条边 $(x,y)\in E$ ，添加容量为 $1$ 的边，最大流即最大匹配。

在图 $G$ 中，大小为 $k$ 的匹配与图 $G'$ 中值为 $k$ 的整数流之间存在一一对应关系。

### 完美匹配

#### 定义

对于图 $G=(V,E)$ ，如果 $V$ 中每个节点都有出现在边集 $M$ 中，就称其为完美匹配。

#### 成立条件（Hall定理）

设二分图 $G=\langle V_1, V_2, E \rangle, |V_1| \leq |V_2|$，则 $G$ 中存在 $V_1$ 到 $V_2$ 的完美匹配当且仅当对于任意的 $S \subset V_1$，均有 $|S|\leq|N(S)|$，其中 $N(S)$ 表示 $S$ 中所有顶点的邻接点的集合

#### 引理1

设 $P$ 是一条关于匹配 $M$ 的增广交错路径，则 $M'=M\oplus P$ 是一个匹配。

其中，$M\oplus P=M\cup P-M\cap P$ 

<img src="/Users/xblock/Library/Application Support/typora-user-images/image-20240622191537492.png" alt="image-20240622191537492" style="zoom: 40%; margin-left: 0" />

#### 引理2

二分图的匹配是最大匹配当且仅当不存在关于它的增广交错路径

### 逐次最短路径算法

增广路径的花费：2-6+10，1和10是将1和1'、2和2'进行匹配所花费的代价，-6是1和2'之间实际没有匹配，所以要减去6

<img src="/Users/xblock/Library/Application Support/typora-user-images/image-20240622194501188.png" alt="image-20240622194501188" style="zoom:40%; margin-left: 0" />

**最短交错路径**：

- 从任意未匹配的节点 $x \in X$ 到任意未匹配的节点 $y \in Y$ 的交错路径，其总成本最小。

**逐次最短路径算法**：

- 从空匹配开始。
- 不断沿着最短的交错路径进行增广。



```
SUCCESSIVE-SHORTEST-PATH (X, Y, c) 
M ← ∅.
FOREACH v ∈ X ∪ Y : p(v) ← 0.

WHILE (M is not a perfect matching)
	d ← shortest path distances using costs cp.
	P ← shortest alternating path using costs cp.
	M ← updated matching after augmenting along P.
	FOREACH v ∈ X ∪ Y : p(v) ← p(v) + d(v).

RETURN M
```



### 匈牙利算法（KM算法）

时间复杂度为 $O(n^3)$ ，用 Dinic 算法解决这一问题的时间复杂度为 $O(n^{1/2}m)$ 



## 不相交路径

### 定义

如果两个路径没有公共边，则认为他们是不相交路径。

### 问题

给定一个有向图 $𝐺=(𝑉,𝐸)$ 和两个节点 $𝑠, 𝑡$ ， 找到其间不相交路径的最大数目.

### 最大流表述

**表述**：

- 为图中的每一条边分配单位容量，即为图 $G'$
- **定理**：在图 G 中，$k$ 条边不相交的从 $s$ 到 $t$ 的路径与图 $G'$ 中值为 $k$ 的整数流之间存在一一对应关系。

#### 证明：从路径到流

**假设**：

- 设 $P_1, P_2, \ldots, P_k$ 是图 $G$ 中 $k$ 条边不相交的从 $s$ 到 $t$ 的路径

**构造流**：

- 定义流 $f(e)$ 如下：如果边 $e$ 参与了一条路径 $P_j$ ，则 $f(e) = 1$ ；否则 $f(e) = 0$

**解释**：
- 因为这些路径是边不相交的，每条边最多参与一条路径。
- 因此，$f$ 是一个有效的流，且其总流量为 $k$ 

#### 证明：从流到路径

设 $f$ 为图 $G'$ 中值为 $k$ 的整数流

考虑一条从源点 $s$ 出发的边 $(s, u)$ ，其流量 $f(s,u)=1$ 

根据流量守恒定律，在节点 $u$ 存在一条流量为1的边 $(u,v)$ ，即 $f(u,v)=1$ 

沿着这条边继续前进，直到到达汇点 t，每次总是选择一条新的流量为1的边。

重复上述过程，直到构造出 k 条从 s 到 t 的路径。

网络连通性是指在一个有向图 \(G = (V, E)\) 中，给定两个节点 \(s\) 和 \(t\)，找出使得从 \(s\) 到 \(t\) 不再连通的最小边集合的问题。

### 网络连通性

一个边集 $F \subseteq E$ 会使得 \(t\) 和 \(s\) 断开连接，如果从 \(s\) 到 \(t\) 的每条路径都至少使用了 \(F\) 中的一条边。

#### 问题描述

给定一个有向图 \($G = (V, E)$\) 和两个节点 \(s\) 和 \(t\)，问题是找出最小数量的边集 \(F\)，使得移除这些边后，从 \(s\) 到 \(t\) 不再连通。

**定理**：从源点 $s$ 到汇点 $t$ 的最大边不相交路径数等于移除最少数量的边以断开 $t$ 和 $s$ 的边集数目。

**证明方向$\leq$ **：

- 假设存在一个边集 $F$，移除这些边后 $t$ 和 $s$ 断开，并且边集 $F$ 的大小为 $k$ 
- 因为每一条从 $s$ 到 $t$ 的路径都需要经过边集中的边，因此不相交的边路径的数目小于 $k$ 

**证明方向 $\geq$ **：

- 假设从 $s$ 到 t 的最大边不相交路径数是 k
- 根据流网络理论，最大流的值等于从 s 到 t 的最大边不相交路径数，因此最大流的值为 k
- 根据**最大流最小割定理**，存在一个割 $(A,B)$ ，其容量为 k
- 设 F 为从 A 到 B 的边集，则 $\|F\| = k$ ，并且 $F$ 断开了 $t$ 和 $s$

### 无向图

在有向图中，两条路径可以是边不相交的，但在无向图中不一定是边不相交的。

因为在无向图中，路径的定义是不考虑边的方向的，所以两条路径可能会共享一些边，即使它们在有向图中是边不相交的。

## 最大流问题扩展

### 多汇点多源点

给定一个带有边容量 $c(e) \geq 0$ 和多个源节点以及多个汇节点的有向图 $G=(V,E)$ ，要求找到从源节点发送到汇节点的最大流量。

#### 解决方案

**添加新的源节点和汇节点**：

- 添加一个新的源节点 s 和一个新的汇节点 t

**为每个原始源节点和汇节点添加边**：

- 对于每个原始的源节点 $s_i$ ，添加一条从 $s$ 到 $s_i$ 的边，容量为无穷大

- 对于每个原始的汇节点 $t_j$ ，添加一条从 $t_j$ 到 $t$ 的边，容量为无穷大

  <img src="/Users/xblock/Library/Application Support/typora-user-images/image-20240621214251849.png" alt="image-20240621214251849" style="zoom:33%;margin-left:0" />

### 带有供需关系的循环

带有供给和需求的流通问题

**定义**：
给定一个有向图 $G = (V, E)$ ，其中每条边 \(e\) 都有容量 \($c(e) \geq 0$\)，每个节点 \(v\) 都有需求 \(d(v)\)，一个流通是一个满足以下条件的函数 \(f(e)\)：

- 对于每条边 \($e \in E$\)，满足 \($0 \leq f(e) \leq c(e)$\)（容量限制）。
- 对于每个节点 $v \in V$ ，满足流量守恒条件 $\sum_{e \text{ in to } v}^{} f(e) - \sum_{e \text{ out of } v}^{} f(e) = d(v)$

#### 解决方案：增加新的源点和汇点

- 为了解决带有供给和需求的流通问题，我们引入了一个新的源点 \(s\) 和一个新的汇点 \(t\)。
- 对于每个需求 \(d(v) < 0\) 的节点 \(v\)，我们添加了一条从源点 \(s\) 到节点 \(v\) 的边，其容量为 $-d(v)$
- 对于每个需求 \(d(v) > 0\) 的节点 \(v\)，我们添加了一条从节点 \(v\) 到汇点 \(t\) 的边，其容量为 $d(v)$

<img src="/Users/xblock/Library/Application Support/typora-user-images/image-20240621215341525.png" alt="image-20240621215341525" style="zoom:33%; margin-left: 0" />

## 调查设计

### 问题定义

- 设计一项调查，询问 \( $n_1$ \) 位消费者对 \( $n_2$ \) 种产品的看法。
- 只有当消费者拥有某种产品时，才能询问他们对该产品的看法。
- 对于每位消费者 \( i \)，询问问题的数量在 \( $c_i$ \) 和 \( $c_i'$ \) 之间。
- 对于每种产品 \( j \)，询问的消费者数量在 \( $p_j$ \) 和 \( $p_j'$ \) 之间。
- 目标是设计一个满足这些规格的调查，如果可能的话。

二分图完美匹配：特殊情况是当 \( $c_i = c'_i = p_j = p'_j = 1$ \) 时。

### 解决方案

- 将问题建模为一个带有下界的流通问题。
- 如果存在整数流通，则说明存在可行的调查设计。
- 具体步骤：
  1. 对于每个消费者 $j$ ，如果消费者 $j$ 拥有产品 $i$ ，则添加边 $(i, j)$ 
  2. 添加从源点 $s$ 到每个消费者 $j$ 的边
  3. 添加从每个产品 $i$ 到汇点 $t$ 的边
  4. 添加从汇点 $t$ 到源点 $s$ 的边
  5. 所有需求都为零

<img src="/Users/xblock/Library/Application Support/typora-user-images/image-20240621221040682.png" alt="image-20240621221040682" style="zoom:33%; margin-left: 0" />

## 航空公司排班问题

### 问题定义

- 通过在多个航班上重复使用航班机组来管理航班机组。
- 输入：给定一天内的 $k$ 个航班。
- 第 $i$ 个航班离开起始地 $o_i$ 在时间 $s_i$ 并在时间 $f_i$ 到达目的地 $d_i$ 
- 最小化航班机组的数量。

### 解决方案

**判断是否存在足够的机组 $c$**：

- 对于每个航班 i，包括两个节点 $u_i$ 和 $v_i$ 
- 添加需求为 -c 的源点 s，并添加边 $(s, u_i)$ 容量为 1
- 添加需求为 c 的汇点 t，并添加边 $(v_i, t)$ 容量为 1
- 对于每个 i，添加下界为 1、容量为 1 的边 $(u_i, v_i)$ 
- 如果航班 j 可从 i 到达，则添加容量为 1 的边 $(v_i, u_j)$ 

**证明：航空公司排班问题可以在 $O(k^3 \log k)$ 时间内解决**：

- $k$ 为航班数量
- $c$ 为机组数量（未知）
- $O(k)$ 个节点，$O(k^2)$ 条边
- 最多需要 $k$ 个机组
  - 解决 $\log_2 k$ 个流通问题
- 任何流的值在 0 和 $k$ 之间
  - 每个流通问题最多进行 $k$ 次增广
- 总体时间为 $O(k^3 \log k)$

