### 稳定匹配问题

用于寻找两组元素之间的稳定匹配，其中没有两个元素比当前匹配更偏好对方，即不存在不稳定对。

#### 不稳定对

在匹配结果中，存在医院 $h$ 和学生 $s$ 同时满足如下条件：

- $h-s$ 不在匹配结果中
- $h$ 比起当前学生，更喜欢 $s$ 
- $s$ 比起当前医院，更喜欢 $h$ 

Gale-Shapley 算法时间复杂度：$O(n^2)$

**步骤**

1. 每个提议者都有一个接收者的偏好列表。
2. 该算法从每个提议者向他们首选的接收者提出提议开始。
3. 如果接收者收到多个提议，他们会选择最喜欢的提议者，并拒绝其他提议者。
4. 被拒绝的提议者继续进行下一个选择并提出提案。
5. 该过程持续，直到所有元素都匹配为止。

**伪代码**

```c++
INITIALIZE M to empty matching.
WHILE (some hospital h is unmatched)
	s ← first student on h’s list to whom h has not yet proposed.
	IF (s is unmatched)
		Add h–s to matching M.
	ELSE IF (s prefers h to current partner hʹ)
		Replace hʹ–s with h–s in matching M.
	ELSE
		s rejects h.
RETURN stable matching M
```

观察1：医院按照偏好的递减顺序向学生提出申请。

观察2：一旦学生匹配成功，就不会再变成未匹配状态；学生只会“升级”匹配。

#### Claim1：Gale-Shapley算法输出一个匹配

- **医院只向未匹配的学生提出申请**：根据算法规则，医院只能向尚未收到申请或比当前临时匹配更好的学生提出申请。这确保了每个学生最多只与一个医院匹配。
- **学生只保留最好的医院**：学生一次只能与一个医院匹配。他们只能接受来自比当前临时匹配更好的医院的申请，或者保持未匹配状态（如果申请比未匹配更好）。

#### Claim2：在Gale-Shapley匹配中，所有医院都得到匹配
**通过反证法证明：**
- **假设**：假设某个医院在算法结束时仍未匹配。
- **矛盾**：如果医院未匹配，那一定是因为它没有收到任何学生的申请。然而，根据观察2，每个学生最终都会被每个医院提出申请，因为如果学生未匹配，医院就会向其提出申请。

#### Claim3：在Gale-Shapley匹配中，所有学生都得到匹配
**计数证明：**
- **所有医院都匹配了**：根据上一个声明，我们知道所有医院都匹配了。
- **所有学生都匹配了**：因为每个医院都与一个学生匹配，因此所有学生也一定都匹配了。

#### 稳定性证明

假设匹配 $h-s$ 没有出现在最终结果，有以下两种情况：

- $h$ 没有向 $s$ 提出申请，这说明 $h$ 有更喜欢的学生 $s'$ ，则 $h-s$ 是不稳定的
- $h$ 向 $s$ 提出了申请，这说明 $s$ 拒绝了 $h$ ，也就是 $s$ 有更喜欢的医院，则 $h-s$ 是不稳定的

以上两种情况都表明 $h-s$ 是不稳定的



Gale-Shapley 算法（hospital optimality）并不保证在所有执行中都得到相同的稳定匹配。这是因为：

- 算法本身是确定性的，但输入的偏好列表可能存在多个稳定匹配，而Gale-Shapley算法可能会根据提出的顺序找到其中的一个。
- 在某些情况下，不同的执行顺序（例如，当医院或学生有多个并列的首选时）可能会导致不同的匹配结果。



学生 $s$ 被认为是医院 $h$ 的一个有效伴侣，如果在任何稳定匹配中 $h$ 和 $s$ 能够匹配在一起。